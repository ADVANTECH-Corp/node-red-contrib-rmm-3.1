<script>    
</script>
<script type="text/javascript">
    RED.nodes.registerType('EmailSend', {
        category: 'RMM31_Event',
        color: 'rgb(230, 224, 248)',
        defaults: {            
            smtpserver: {value: ""},
            smtpport: {value: ""},
            smtptype: {value:"ssl"},
            /*smtpaccount: {value:""},
            smtppwd: {value:""},*/
            smtpencodestr: {value:""},
            smtpsender: {value:""},
            smtpsubject: {value:""},
            smtprecipient: {value:""},
            smtpcontent: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "arrow-in.png",
        label: function () {
            return this.name || "EmailSend";
        },
        oneditprepare: function () {
            $('#node-input-name').val(this.name);            
            $('#node-sa-input-server').val(this.smtpserver);
            $('#node-sa-input-smtpport').val(this.smtpport);
            $('#node-sa-input-smtptype').val(this.smtptype);
            $('#node-sa-input-smtpsender').val(this.smtpsender);
            $('#node-sa-input-smtpsubject').val(this.smtpsubject);
            $('#node-sa-input-smtprecipient').val(this.smtprecipient);
            $('#node-sa-input-smtpcontent').val(this.smtpcontent);
        },
        oneditsave: function () {
            this.name = $('#node-input-name').val();            
            this.smtpserver = $('#node-sa-input-server').val();
            this.smtpport = $('#node-sa-input-smtpport').val();
            this.smtptype = $('#node-sa-input-smtptype').val();
            this.smtpsender = $('#node-sa-input-smtpsender').val();
            this.smtpsubject = $('#node-sa-input-smtpsubject').val();
            this.smtprecipient = $('#node-sa-input-smtprecipient').val();
            this.smtpcontent = $('#node-sa-input-smtpcontent').val();   
            var username = $('#node-sa-input-smtpaccount').val();
            var pwd = $('#node-sa-input-smtppwd').val();
            this.smtpencodestr = btoa(username + '$' + pwd);
        }
    });
</script>

<script type="text/x-red" data-template-name="EmailSend">
    <div class="form-row">
    <label for="node-input-name"><i class="icon-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Node Name">
    </div>    
    <div class="form-row">
    <label for="node-sa-input-server"><i class="fa fa-globe"></i> Server</label>
    <input type="text" id="node-sa-input-server" placeholder="SMTP Server">
    </div> 
    <div class="form-row">
    <label for="node-sa-input-smtpport"><i class="fa fa-random"></i> Port</label>
    <input type="text" id="node-sa-input-smtpport" placeholder="SMTP Port" style="width: 30%">
    <select id="node-sa-input-smtptype" style="width: 30%">
    <option value='ssl'>SSL</option>
    <option value='tls'>TLS</option>
    </select>
    </div> 
    <div class="form-row">
    <label for="node-sa-input-smtpaccount"><i class="fa fa-user"></i> Account</label>
    <input type="text" id="node-sa-input-smtpaccount" placeholder="SMTP Account">
    </div> 
    <div class="form-row">
    <label for="node-sa-input-smtppwd"><i class="fa fa-lock"></i> Password</label>
    <input type="password" id="node-sa-input-smtppwd" placeholder="SMTP Password">
    </div> 
    <div class="form-row">
    <label for="node-sa-input-smtpsender"><i class="fa fa-user"></i> Sender</label>
    <input type="text" id="node-sa-input-smtpsender" placeholder="SMTP Sender">
    </div> 
    <div class="form-row">
    <label for="node-sa-input-smtpsubject"><i class="fa fa-user"></i> Subject</label>
    <input type="text" id="node-sa-input-smtpsubject" placeholder="SMTP Subject">
    </div> 
    <div class="form-row">
    <label for="node-sa-input-smtprecipient"><i class="fa fa-envelope"></i> Recipient</label>
    <input type="text" id="node-sa-input-smtprecipient" placeholder="SMTP Recipient">
    </div> 
    <div class="form-row node-input-rule-container-row" style="margin-bottom: 0px;">
        <textarea placeholder="Please enter the email content here" id="node-sa-input-smtpcontent" style="box-sizing: border-box; border-radius: 5px; height: 150px; padding: 5px; border: 1px solid #ccc; overflow:auto; resize:none; width:100%;"></textarea>
    </div>
</script>

<script type="text/x-red" data-help-name="EmailSend">
    <p>Send the mail.</p>
    <p>User set the server ip (<code>msg.url</code>), port (<code>msg.port</code>), username (<code>msg.username</code>) and password (<code>msg.pwd</code>).</p>
    <p>User can set the server, port, type, account, passowrd, sender, subject, recipient and content of smtp under this node or set <code>msg.smtpserver</code>, <code>msg.smtpport</code>, <code>msg.smtptype</code>, <code>msg.smtpaccount</code>, <code>msg.smtppwd</code>, <code>msg.smtpsender</code>, <code>msg.smtpsubject</code>, <code>msg.smtprecipient</code> and <code>msg.smtpcontent</code>. </p>
    <p>If you set <code>msg.smtpserver</code>, <code>msg.smtpport</code>, <code>msg.smtptype</code>, <code>msg.smtpaccount</code>, <code>msg.smtppwd</code>, <code>msg.smtpsender</code>, <code>msg.smtpsubject</code>, <code>msg.smtprecipient</code> and <code>msg.smtpcontent</code>, the setting of this node will be override. </p>
</script>